define(["utils/pages","utils/ajax","utils/xhrHandler","defaults"],function(t,s,o,e){return{name:"ajaxMission",selector:"#ourMission",options:{count:0,max:3,ajaxURL:e.ourMission(),selector:"#ourMission"},initialize:function(){console.log(this.name+":initialize"),this.options.ajaxSuccess=this.success,this.options.ajaxError=this.error,s.initialize(this.selector)},load:function(){console.log(this.name+":load"),this.initialize(),console.log(this.name+":load:count:="+this.options.count),console.log(this.results),s.load(this,this.options),this.options.count=this.options.count+1},xhrCheck:function(t,s){return console.log(this.name+":xhrCheck"),console.log("<===== XHR ===>"),console.log(JSON.stringify(t)),o.check(t,s)},processData:function(t){console.log("<===== RAW DATA ===>"),console.log(t);var s=$("#content",$(t));console.log("<===== #content ===>"),console.log(s.html()),$(this.selector).html(s.html()),this.hideData(),this.fixDiscoveryLink(),this.fixDevelopmentLink(),$(this.selector+' a[href$="connecting-thru-service"]').before("<br/>"),this.fixImages(this.selector+" img"),$(this.selector).trigger("create")},show:function(){console.log(this.name+":show"),t.show("about")},hideData:function(){$(this.selector+' h2:contains("Download")').hide(),$(this.selector+' table[class="contentTable"]').hide(),$(this.selector+" hr").hide()},fixDiscoveryLink:function(){$(this.selector+' a[href*="id=2040"]').each(function(){$(this).attr("href","#ourDiscoveryClass"),$(this).parent().removeAttr("style"),$(this).before("<br/>"),$(this).parent().html(function(t,s){return s.replace("-","<br/>")})})},fixDevelopmentLink:function(){$(this.selector+' a[href*="id=2048"]').each(function(){$(this).attr("href","#ourDevelopmentClass"),$(this).parent().removeAttr("style"),$(this).before("<br/>"),$(this).parent().html(function(t,s){return s.replace("-","<br/>")})})},fixImages:function(t){console.log(this.name+"fixImages(selector)"),$(t).each(function(){$(this).removeAttr("style"),$(this).addClass("img-responsive");var t=$(this).attr("src"),s=new RegExp("(http|https)://","i");s.test(t)===!1&&(t="http://fbcvr.com/"+t,$(this).attr("src",t))})},hideElements:function(t){$(t).each(function(){$(this).hide()})},success:function(t,s,o){console.log("success"),console.log(JSON.stringify(this._this.options)),console.log("selector:="+this._this.options.selector),this._this.xhrCheck(o,this._this.options.selector)===!0&&(console.log("data"),console.log(t),console.log("status:"),console.log(s),this._this.processData(t))},error:function(t){console.log("ajax error handler"),this._this.xhrCheck(t,this._this.options.selector)===!0&&(console.log(JSON.stringify(this._this.options)),this._this.load(this._this.options))},maxCount:function(){alert("handle bad results")}}});